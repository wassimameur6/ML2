<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serfy Bank - Customer Retention Platform</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <img src="srf.jpeg" alt="Serfy Bank" class="logo-img">
            <h1>Serfy Bank</h1>
            <span class="logo-subtitle">Retention Platform</span>
        </div>

        <nav class="nav">
            <a href="#" class="nav-item active" data-page="dashboard">
                <span class="nav-icon">üìä</span>
                Dashboard
            </a>
            <a href="#" class="nav-item" data-page="customers">
                <span class="nav-icon">üë§</span>
                Customers
            </a>
            <a href="#" class="nav-item" data-page="at-risk">
                <span class="nav-icon">‚ö†Ô∏è</span>
                At-Risk
            </a>
            <a href="#" class="nav-item" data-page="campaigns">
                <span class="nav-icon">üìß</span>
                Campaigns
            </a>
            <a href="#" class="nav-item" data-page="offers">
                <span class="nav-icon">üéÅ</span>
                Offers
            </a>
            <a href="#" class="nav-item" data-page="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                Settings
            </a>
        </nav>


        <div class="sidebar-footer">
            <span>v3.0</span>
            <span id="current-time"></span>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <header class="page-header">
                <h1>Retention Analytics Dashboard</h1>
                <p>Real-time customer insights and churn intelligence</p>
            </header>

            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <span class="kpi-label">Total Customers</span>
                    <span class="kpi-value" id="kpi-total">-</span>
                    <span class="kpi-sub">Base population</span>
                </div>
                <div class="kpi-card">
                    <span class="kpi-label">Retention Rate</span>
                    <span class="kpi-value success" id="kpi-retention">-</span>
                    <span class="kpi-sub success">‚Üë 2.1% vs last quarter</span>
                </div>
                <div class="kpi-card">
                    <span class="kpi-label">Churn Rate</span>
                    <span class="kpi-value danger" id="kpi-churn">-</span>
                    <span class="kpi-sub success">‚Üì 2.1% improvement</span>
                </div>
                <div class="kpi-card">
                    <span class="kpi-label">Churned Customers</span>
                    <span class="kpi-value warning" id="kpi-atrisk">-</span>
                    <span class="kpi-sub">Historical attrition</span>
                </div>
                <div class="kpi-card">
                    <span class="kpi-label">Revenue Lost</span>
                    <span class="kpi-value danger" id="kpi-revenue">-</span>
                    <span class="kpi-sub">Est. annual value</span>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-row">
                <div class="chart-card large">
                    <h3>Churn Rate Trend (12 Months)</h3>
                    <div class="chart-container">
                        <canvas id="chart-trend"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Customer Status</h3>
                    <div class="chart-container">
                        <canvas id="chart-risk"></canvas>
                    </div>
                </div>
            </div>

            <!-- Segmentation Row -->
            <div class="section-header">
                <h2>Customer Segmentation Analysis</h2>
            </div>
            <div class="charts-row three-col">
                <div class="chart-card">
                    <h3>Churn Risk by Income</h3>
                    <div class="chart-container-sm">
                        <canvas id="chart-income"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>At-Risk by Card Type</h3>
                    <div class="chart-container-sm">
                        <canvas id="chart-cards"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Risk by Tenure</h3>
                    <div class="chart-container-sm">
                        <canvas id="chart-tenure"></canvas>
                    </div>
                </div>
            </div>


            <!-- Actions Row -->
            <div class="actions-row">
                <button class="btn" onclick="exportSummary()">üì• Export Summary</button>
                <button class="btn" onclick="exportAtRisk()">üì• At-Risk List</button>
                <button class="btn" onclick="refreshData()">üîÑ Refresh Data</button>
                <span class="last-updated">Last updated: <span id="last-updated">-</span></span>
            </div>
        </div>

        <!-- Customers Page -->
        <div id="page-customers" class="page">
            <header class="page-header">
                <h1>Customer Lookup</h1>
                <p>Search and analyze individual customers</p>
            </header>

            <div class="search-box">
                <input type="text" id="customer-search" placeholder="Enter Customer ID (e.g., 768805383)">
                <button class="btn primary" onclick="searchCustomer()">Search</button>
            </div>

            <div id="customer-result" class="customer-result hidden">
                <div class="customer-grid">
                    <div class="customer-profile card">
                        <h3>Customer Profile</h3>
                        <div id="customer-details"></div>
                    </div>
                    <div class="customer-risk card">
                        <h3>Risk Analysis</h3>
                        <div id="risk-analysis"></div>
                    </div>
                </div>
                <div class="recommendations-section">
                    <h3>Recommended Offers</h3>
                    <div id="customer-offers" class="offers-grid"></div>
                </div>
            </div>
        </div>

        <!-- At-Risk Page -->
        <div id="page-at-risk" class="page">
            <header class="page-header">
                <h1>At-Risk Customers</h1>
                <p>Customers with high churn probability</p>
            </header>

            <div class="filters-row">
                <div class="filter-group">
                    <label>Minimum Risk Threshold</label>
                    <input type="range" id="risk-threshold" min="0" max="100" value="50">
                    <span id="threshold-value">50%</span>
                </div>
                <div class="filter-group">
                    <label>Max Results</label>
                    <input type="number" id="max-results" value="50" min="10" max="200">
                </div>
                <button class="btn primary" onclick="findAtRiskCustomers()">Find Customers</button>
            </div>

            <div id="at-risk-results" class="hidden">
                <div class="results-summary">
                    <div class="summary-item">
                        <span class="summary-value" id="ar-found">0</span>
                        <span class="summary-label">Found</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="ar-showing">0</span>
                        <span class="summary-label">Showing</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="ar-threshold">0%</span>
                        <span class="summary-label">Threshold</span>
                    </div>
                </div>
                <div class="table-container">
                    <table id="at-risk-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Risk</th>
                                <th>Level</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Campaigns Page -->
        <div id="page-campaigns" class="page">
            <header class="page-header">
                <h1>Campaigns</h1>
                <p>Launch retention email campaigns</p>
            </header>

            <div class="kpi-grid four-col">
                <div class="kpi-card">
                    <span class="kpi-label">This Month</span>
                    <span class="kpi-value">12</span>
                </div>
                <div class="kpi-card">
                    <span class="kpi-label">Emails Sent</span>
                    <span class="kpi-value">1,247</span>
                </div>
                <div class="kpi-card">
                    <span class="kpi-label">Response Rate</span>
                    <span class="kpi-value">34%</span>
                </div>
                <div class="kpi-card">
                    <span class="kpi-label">Retention</span>
                    <span class="kpi-value success">78%</span>
                </div>
            </div>

            <div class="campaign-config card">
                <h3>Campaign Settings</h3>
                <div class="config-grid">
                    <div class="config-section">
                        <h4>Automatic Targeting</h4>
                        <div class="form-group">
                            <label>Target risk above</label>
                            <input type="range" id="campaign-threshold" min="0" max="100" value="60">
                            <span id="campaign-threshold-value">60%</span>
                        </div>
                        <div class="form-group">
                            <label>Max customers</label>
                            <input type="number" id="campaign-max" value="50" min="1" max="1000">
                        </div>
                    </div>
                    <div class="config-section">
                        <h4>Manual Targeting</h4>
                        <div class="form-group">
                            <label>Customer IDs</label>
                            <textarea id="campaign-ids" placeholder="768805383, 818770008&#10;(comma separated)"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="send-live">
                        <strong>Send live emails</strong>
                    </label>
                    <p class="hint" id="campaign-hint">Simulation mode ‚Äî no emails will be sent</p>
                </div>

                <button class="btn primary large" onclick="launchCampaign()">üöÄ Launch Campaign</button>
            </div>

            <div id="campaign-results" class="hidden">
                <h3>Campaign Results</h3>
                <div id="campaign-details"></div>
            </div>
        </div>

        <!-- Offers Page -->
        <div id="page-offers" class="page">
            <header class="page-header">
                <h1>Offers Library</h1>
                <p>Available retention offers</p>
            </header>

            <div class="offers-header">
                <div class="kpi-card inline">
                    <span class="kpi-label">Total Offers</span>
                    <span class="kpi-value" id="total-offers">-</span>
                </div>
                <div class="filter-group">
                    <label>Filter by type</label>
                    <select id="offer-filter" onchange="filterOffers()">
                        <option value="all">All Types</option>
                    </select>
                </div>
            </div>

            <div id="offers-grid" class="offers-grid"></div>
        </div>

        <!-- Settings Page -->
        <div id="page-settings" class="page">
            <header class="page-header">
                <h1>Settings</h1>
                <p>System configuration</p>
            </header>

            <div class="tabs">
                <button class="tab active" data-tab="system">System</button>
                <button class="tab" data-tab="email">Email</button>
                <button class="tab" data-tab="ai">AI</button>
            </div>

            <div id="tab-system" class="tab-content active">
                <div class="card">
                    <h3>Component Status</h3>
                    <div class="status-table" id="component-status"></div>
                </div>
                <div class="card">
                    <h3>API</h3>
                    <code id="api-url">http://localhost:8080</code>
                </div>
            </div>

            <div id="tab-email" class="tab-content">
                <div class="card">
                    <h3>Email Configuration</h3>
                    <p class="info-box">Configured via environment variables (.env)</p>
                    <ul class="config-list">
                        <li><strong>SMTP Host:</strong> smtp.gmail.com</li>
                        <li><strong>SMTP Port:</strong> 587</li>
                        <li><strong>Company:</strong> Serfy Bank</li>
                    </ul>
                </div>
            </div>

            <div id="tab-ai" class="tab-content">
                <div class="card">
                    <h3>AI Pipeline</h3>
                    <ol class="pipeline-list">
                        <li><strong>Prediction</strong> ‚Äî Random Forest model</li>
                        <li><strong>Matching</strong> ‚Äî ChromaDB semantic search</li>
                        <li><strong>Ranking</strong> ‚Äî GPT relevance scoring</li>
                        <li><strong>Generation</strong> ‚Äî GPT email personalization</li>
                    </ol>
                </div>
                <div class="card">
                    <h3>Model Info</h3>
                    <p class="model-info">Random Forest ‚Ä¢ 19 features ‚Ä¢ 10,127 training samples</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <script src="app.js"></script>
</body>
</html>
